---
title: kafka
tags: kafka
abbrlink: 13749
date: 2017-12-16 12:03:28
---

###kafkaæ¦‚è¿°
<image src=https://kafka.apache.org/images/logo.png width=300>

#### å…³äºå¿«é€Ÿå­¦ä¹ æ–¹æ³•é¢†æ‚Ÿ
- å­¦ä¹ ä¸ç†Ÿæ‚‰çš„é¢†åŸŸå’ŒçŸ¥è¯†ï¼Œè¦å¿«é€Ÿæ‰¾å‡ºæŠ€æœ¯çš„åŸç†ï¼Œæ ¸å¿ƒåŠŸèƒ½ç‚¹ï¼Œèƒ½åšä»€ä¹ˆèƒ½ï¼Œç”¨äºè§£å†³ä»€ä¹ˆé—®é¢˜ã€‚
- æš‚æ—¶å¿½ç•¥æŠ€æœ¯ç»†èŠ‚ï¼Œæ‰¾å‡ºæŠ€æœ¯ä¸»å¹²ï¼Œæ ¹æ®é¡¹ç›®å’Œæ—¥åå­¦ä¹ å¾ªåºæ¸è¿›åˆ°ç»†èŠ‚éƒ¨åˆ†ã€‚

#### ä¸€ï¼Œkafkaæ˜¯ä»€ä¹ˆ
- Apache kafkaæ˜¯æ¶ˆæ¯ä¸­é—´ä»¶çš„ä¸€ç§ï¼Œå…³äºæ¶ˆæ¯ä¸­é—´ä»¶æ‘˜å½•ä¸€æ®µç½‘ä¸Šæ¯”è¾ƒå¥½çš„é€šä¿—ç†è§£ã€‚
- ä¸¾ä¸ªä¾‹å­ï¼Œç”Ÿäº§è€…æ¶ˆè´¹è€…ï¼Œç”Ÿäº§è€…ç”Ÿäº§é¸¡è›‹ï¼Œæ¶ˆè´¹è€…æ¶ˆè´¹é¸¡è›‹ï¼Œç”Ÿäº§è€…ç”Ÿäº§ä¸€ä¸ªé¸¡è›‹ï¼Œæ¶ˆè´¹è€…å°±æ¶ˆè´¹ä¸€ä¸ªé¸¡è›‹ï¼Œå‡è®¾æ¶ˆè´¹è€…æ¶ˆè´¹é¸¡è›‹çš„æ—¶å€™å™ä½äº†ï¼ˆç³»ç»Ÿå®•æœºäº†ï¼‰ï¼Œç”Ÿäº§è€…è¿˜åœ¨ç”Ÿäº§é¸¡è›‹ï¼Œé‚£æ–°ç”Ÿäº§çš„é¸¡è›‹å°±ä¸¢å¤±äº†ã€‚å†æ¯”å¦‚ç”Ÿäº§è€…å¾ˆå¼ºåŠ²ï¼ˆå¤§äº¤æ˜“é‡çš„æƒ…å†µï¼‰ï¼Œç”Ÿäº§è€…1ç§’é’Ÿç”Ÿäº§100ä¸ªé¸¡è›‹ï¼Œæ¶ˆè´¹è€…1ç§’é’Ÿåªèƒ½åƒ50ä¸ªé¸¡è›‹ï¼Œé‚£è¦ä¸äº†ä¸€ä¼šï¼Œæ¶ˆè´¹è€…å°±åƒä¸æ¶ˆäº†ï¼ˆæ¶ˆæ¯å µå¡ï¼Œæœ€ç»ˆå¯¼è‡´ç³»ç»Ÿè¶…æ—¶ï¼‰ï¼Œæ¶ˆè´¹è€…æ‹’ç»å†åƒäº†ï¼Œâ€é¸¡è›‹â€œåˆä¸¢å¤±äº†ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬æ”¾ä¸ªç¯®å­åœ¨å®ƒä»¬ä¸­é—´ï¼Œç”Ÿäº§å‡ºæ¥çš„é¸¡è›‹éƒ½æ”¾åˆ°ç¯®å­é‡Œï¼Œæ¶ˆè´¹è€…å»ç¯®å­é‡Œæ‹¿é¸¡è›‹ï¼Œè¿™æ ·é¸¡è›‹å°±ä¸ä¼šä¸¢å¤±äº†ï¼Œéƒ½åœ¨ç¯®å­é‡Œï¼Œè€Œè¿™ä¸ªç¯®å­å°±æ˜¯â€kafkaâ€œã€‚
é¸¡è›‹å…¶å®å°±æ˜¯â€œæ•°æ®æµâ€ï¼Œç³»ç»Ÿä¹‹é—´çš„äº¤äº’éƒ½æ˜¯é€šè¿‡â€œæ•°æ®æµâ€æ¥ä¼ è¾“çš„ï¼ˆå°±æ˜¯tcpã€httpä»€ä¹ˆçš„ï¼‰ï¼Œä¹Ÿç§°ä¸ºæŠ¥æ–‡ï¼Œä¹Ÿå«â€œæ¶ˆæ¯â€ã€‚
æ¶ˆæ¯é˜Ÿåˆ—æ»¡äº†ï¼Œå…¶å®å°±æ˜¯ç¯®å­æ»¡äº†ï¼Œâ€é¸¡è›‹â€œ æ”¾ä¸ä¸‹äº†ï¼Œé‚£èµ¶ç´§å¤šæ”¾å‡ ä¸ªç¯®å­ï¼Œå…¶å®å°±æ˜¯kafkaçš„æ‰©å®¹ã€‚
å„ä½ç°åœ¨çŸ¥é“kafkaæ˜¯å¹²ä»€ä¹ˆçš„äº†å§ï¼Œå®ƒå°±æ˜¯é‚£ä¸ª"ç¯®å­"


#### äºŒï¼Œkafkaå’Œæ ¸å¿ƒåŠŸèƒ½
- **å‘å¸ƒè®¢é˜…**:æ¶ˆæ¯ä¼ é€’ç³»ç»Ÿï¼Œå‘å¸ƒå’Œè®¢é˜…è®°å½•æµï¼Œç±»ä¼¼æ¶ˆæ¯é˜Ÿåˆ—å’Œä¼ä¸šçº§çš„æ¶ˆæ¯ç³»ç»Ÿ
- **å¤„ç†:** é«˜æ•ˆå®æ—¶å¤„ç†ï¼Œä»¥æµçš„å½¢å¼å¤„ç†è®°å½•
- **å­˜å‚¨:**æ•°æ®æµå®‰å…¨åœ°åœ¨åˆ†å¸ƒå¼é›†ç¾¤ä¸­å¤åˆ¶å­˜å‚¨ï¼Œä»¥å®¹é”™çš„æ–¹å¼å­˜å‚¨è®°å½•æµã€‚

#### ä¸‰ï¼Œkafkaç›¸å…³æœ¯è¯­
- **Topicï¼š**Kafkaå°†æ¶ˆæ¯ç§å­(Feed)åˆ†é—¨åˆ«ç±»ï¼Œ æ¯ä¸€ç±»çš„æ¶ˆæ¯ç§°ä¹‹ä¸ºè¯é¢˜(Topic).
-  **Producerï¼š**å‘å¸ƒæ¶ˆæ¯çš„å¯¹è±¡ç§°ä¹‹ä¸ºè¯é¢˜ç”Ÿäº§è€…(Kafka topic producer)
-  **Consumerï¼š**è®¢é˜…æ¶ˆæ¯å¹¶å¤„ç†å‘å¸ƒçš„æ¶ˆæ¯çš„ç§å­çš„å¯¹è±¡ç§°ä¹‹ä¸ºè¯é¢˜æ¶ˆè´¹è€…(consumers)
-  **Brokerï¼š**å·²å‘å¸ƒçš„æ¶ˆæ¯ä¿å­˜åœ¨ä¸€ç»„æœåŠ¡å™¨ä¸­ï¼Œç§°ä¹‹ä¸ºKafkaé›†ç¾¤ã€‚é›†ç¾¤ä¸­çš„æ¯ä¸€ä¸ªæœåŠ¡å™¨éƒ½æ˜¯ä¸€ä¸ªä»£ç†(Broker). æ¶ˆè´¹è€…å¯ä»¥è®¢é˜…ä¸€ä¸ªæˆ–å¤šä¸ªè¯é¢˜ï¼Œå¹¶ä»Brokeræ‹‰æ•°æ®ï¼Œä»è€Œæ¶ˆè´¹è¿™äº›å·²å‘å¸ƒçš„æ¶ˆæ¯ï¼ˆæœ‰ç‚¹ä¸Šè¾¹ç¯®å­çš„æ„æ€ï¼‰

#### å››ï¼ŒMacå®‰è£…kafka
- brew install kafka

```
Updating Homebrew...
==> Auto-updated Homebrew!
Updated 1 tap (caskroom/cask).
No changes to formulae.

==> Downloading https://homebrew.bintray.com/bottles/kafka-0.11.0.1.sierra.bottle.1.tar.gz
######################################################################## 100.0%
==> Pouring kafka-0.11.0.1.sierra.bottle.1.tar.gz
==> Caveats
To have launchd start kafka now and restart at login:
  brew services start kafka
Or, if you don't want/need a background service you can just run:
  zookeeper-server-start /usr/local/etc/kafka/zookeeper.properties & kafka-server-start /usr/local/etc/kafka/server.properties
==> Summary
ğŸº  /usr/local/Cellar/kafka/0.11.0.1: 149 files, 35.5MB

```

- kafkaå¯åŠ¨ä¾èµ–zookeeperï¼Œéœ€è¦å…ˆå¯åŠ¨zookepper

```
/usr/local/Cellar/zookeeper/3.4.10/bin$./zkServer start
ZooKeeper JMX enabled by default
Using config: /usr/local/etc/zookeeper/zoo.cfg
Starting zookeeper ... STARTE
```

#### äº”ï¼Œä½¿ç”¨å®˜æ–¹ä¾‹å­

- åˆ°è¿™ä¸ª /usr/local/Cellar/kafka/0.11.0.1$ä¸‹
- sudo ./bin/kafka-server-start  ./libexec/config/server.properties
- åˆ›å»ºä¸€ä¸ªåä¸ºâ€œtestâ€çš„Topicï¼Œåªæœ‰ä¸€ä¸ªåˆ†åŒºå’Œä¸€ä¸ªå¤‡ä»½ï¼šåˆ°/usr/local/Cellar/kafka/0.11.0.1$

```
bin/kafka-topics  --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic test
```
- å¯åŠ¨ç”Ÿæˆè€…

```
bin/kafka-console-producer --broker-list localhost:9092 --topic test
```

- è¾“å…¥ï¼š

```
  This is a message
  This is another message
  hello world
```
  
- æŸ¥çœ‹æ¶ˆè´¹

```
 bin/kafka-console-consumer --bootstrap-server localhost:9092 --topic test --from-beginning
 
```

#### è®¾ç½®å¤šä¸ªbrokeré›†ç¾¤æ–¹å¼ï¼Œå‚è§å®˜ç½‘ 
